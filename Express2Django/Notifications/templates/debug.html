{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Debug</title>
</head>
<body>
    <h1>Notification Debug</h1>
    
    <div id="status">Checking status...</div>
    
    <h2>Device Information</h2>
    <pre id="deviceInfo"></pre>
    
    <h2>Service Worker Status</h2>
    <pre id="swStatus"></pre>
    
    <h2>Push Subscription</h2>
    <pre id="pushSubscription"></pre>
    
    <h2>Test Notification</h2>
    <button id="testBtn">Send Test Notification</button>
    
    <script>
        // Display device info
        document.getElementById('deviceInfo').textContent = JSON.stringify({
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            vendor: navigator.vendor,
            language: navigator.language,
            online: navigator.onLine,
            pushSupported: 'PushManager' in window,
            notificationSupported: 'Notification' in window,
            serviceWorkerSupported: 'serviceWorker' in navigator
        }, null, 2);
        
        // Check service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                document.getElementById('swStatus').textContent = JSON.stringify(
                    registrations.map(r => ({
                        scope: r.scope,
                        active: !!r.active,
                        installing: !!r.installing,
                        waiting: !!r.waiting,
                        updateViaCache: r.updateViaCache
                    })), null, 2
                );
            });
        } else {
            document.getElementById('swStatus').textContent = 'Service Workers not supported';
        }
        
        // Check push subscription
        if ('serviceWorker' in navigator && 'PushManager' in window) {
            navigator.serviceWorker.ready.then(registration => {
                return registration.pushManager.getSubscription();
            }).then(subscription => {
                document.getElementById('pushSubscription').textContent = 
                    subscription ? 'Subscription active' : 'No active subscription';
            }).catch(err => {
                document.getElementById('pushSubscription').textContent = 'Error: ' + err.message;
            });
        } else {
            document.getElementById('pushSubscription').textContent = 'Push not supported';
        }
        
        // Test button
        document.getElementById('testBtn').addEventListener('click', () => {
            if (Notification.permission === 'granted') {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification('Debug Test', {
                        body: 'This is a test notification',
                        icon: '/static/icons/icon-192x192.png'
                    });
                });
            } else {
                alert('Notification permission not granted');
            }
        });
        
        // Overall status
        document.getElementById('status').textContent = 
            'Notification permission: ' + Notification.permission;
    </script>
</body>
</html>